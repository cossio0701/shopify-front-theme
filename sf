#!/bin/bash

# sf - Shopify Flow CLI para gestionar cambios entre Git y Shopify Admin
# Versión: 1.0
# Autor: Asistente de desarrollo

# Variables globales
SHOPIFY_STORE="${SHOPIFY_STORE:-}"
SHOPIFY_THEME_ID="${SHOPIFY_THEME_ID:-}"
CURRENT_BRANCH=""
HISTORY_FILE=".sf_history"

# Función principal
main() {
    case "${1:-help}" in
        init) source commands/init.sh; init "$@" ;;
        *) 
            source utils/env.sh
            load_env
            validate_dependencies

            # Validaciones preventivas inteligentes
            source utils/git.sh
            if ! preventive_checks "$1"; then
                return 1
            fi

            # Sugerencias inteligentes
            smart_suggestions "$1"

            case "$1" in
                start) source commands/start.sh; start ;;
                commit) source commands/commit.sh; commit ;;
                merge) shift; source commands/merge.sh; merge "$@" ;;
                publish) shift; source commands/publish.sh; publish "$@" ;;
                sync) shift; source commands/sync.sh; sync "$@" ;;
                resolve) source commands/resolve.sh; resolve ;;
                status) source commands/status.sh; status ;;
                finish) source commands/finish.sh; finish ;;
                stash) source commands/stash.sh; stash ;;
                log) shift; source commands/log.sh; log "$@" ;;
                diff) shift; source commands/diff.sh; diff "$@" ;;
                clean) shift; source commands/clean.sh; clean "$@" ;;
                backup) shift; source commands/backup.sh; backup "$@" ;;
                pr) shift; source commands/pr.sh; pr "$@" ;;
                dev) shift; source commands/dev.sh; dev "$@" ;;
                help|--help|-h) source commands/help.sh; help ;;
                *) echo "❌ Comando desconocido: $1"; source commands/help.sh; help; exit 1 ;;
            esac
            ;;
    esac
}

# Para agregar un nuevo comando 'nuevo':
# 1. Crear commands/nuevo.sh con la función 'nuevo()'
# 2. En main(), agregar: source commands/nuevo.sh; nuevo "$@"
# 3. Asegurar que source los utils necesarios en nuevo.sh
# 4. Si llama a otros comandos, sourcearlos en nuevo.sh

main "$@"
