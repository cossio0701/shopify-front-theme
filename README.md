# sf - Shopify Flow CLI v1.0

Un CLI en Bash para gestionar flujos de trabajo entre Git y Shopify Admin, evitando conflictos y facilitando la sincronizaci√≥n.

## üöÄ Flujo Principal de Desarrollo

Para realizar un cambio y publicarlo r√°pidamente (despu√©s de la configuraci√≥n inicial):

1. **Sincroniza antes de trabajar**: `sf sync`
2. **Inicia desarrollo**: `sf start` (crea rama)
3. **Desarrolla tus cambios** en el c√≥digo
4. **Prueba localmente**: `sf dev`
5. **Confirma cambios**: `sf commit`
6. **Fusiona rama a master**: `sf merge --dry-run` (simula merge)
7. **Fusiona rama**: `sf merge` (fusiona y sincroniza con Shopify)
8. **Prueba la fusi√≥n**: `sf dev --test` (verifica que todo funcione)
9. **Publica en Shopify**: `sf publish`
10. **Limpia**: `sf finish`

**Diagrama del flujo:**

```text
Sync ‚Üí Start ‚Üí Develop ‚Üí Test ‚Üí Commit ‚Üí Merge ‚Üí Test Merge ‚Üí Publish ‚Üí Finish
   ‚Üë                                                                        ‚Üì
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Repite para siguiente cambio ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üß† Caracter√≠sticas Inteligentes

El script sf incluye validaciones preventivas y sugerencias inteligentes para evitar errores comunes:

- **üîç Validaciones preventivas:** Detecta problemas antes de que ocurran (repositorio no inicializado, conexiones faltantes)
- **üí° Sugerencias contextuales:** Recomienda pr√≥ximos pasos basados en el estado actual del proyecto
- **‚ö†Ô∏è Detecci√≥n de conflictos:** Identifica posibles conflictos antes de operaciones cr√≠ticas
- **üíæ Backups autom√°ticos:** Crea respaldos antes de operaciones riesgosas
- **üìä An√°lisis de estado:** Proporciona informaci√≥n completa del estado del proyecto y rama actual

Cada comando incluye mensajes espec√≠ficos con soluciones cuando algo sale mal.

### Configuraci√≥n Inicial (una sola vez por proyecto)

Antes de comenzar a desarrollar, configura el proyecto una vez:

- **Instala dependencias**: Aseg√∫rate de tener Git y Shopify CLI instalados.

## üì¶ Instalaci√≥n R√°pida

```bash
# 1. Da permisos de ejecuci√≥n al script sf
chmod +x sf

# 2. Configura alias global para ejecutar sf desde cualquier directorio
echo 'alias sf="/ruta/absoluta/al/proyecto/sf"' >> ~/.bashrc
source ~/.bashrc

# 3. Inicializa el proyecto (esto genera el archivo .env)
sf init

# 4. Configura las variables de entorno en el archivo .env generado
# Edita .env y establece:
# SHOPIFY_STORE="tu-tienda.myshopify.com"
# SHOPIFY_THEME_ID="123456789"
```

### 1. `sf init` - Configuraci√≥n Inicial

**¬øQu√© hace?** Prepara el proyecto para usar sf, creando archivos de configuraci√≥n y verificando dependencias.

**Cu√°ndo usarlo:** Una sola vez por proyecto, antes de empezar a trabajar.

```bash
sf init
# ‚úÖ Crea .env si no existe
# ‚úÖ Valida dependencias (Git, Shopify CLI)
# ‚úÖ Configura hooks de Git si es necesario

# Reinicializar proyecto completamente
sf init --force
# ‚úÖ Fuerza reinicializaci√≥n sin confirmaci√≥n
# ‚úÖ Reconfigura todos los componentes
```

**Opciones disponibles:**

- `--force`: Reinicializa el proyecto completamente sin pedir confirmaci√≥n

### 2. `sf sync` - Sincronizar con Shopify Admin

**¬øQu√© hace?** Trae cambios realizados manualmente en Shopify Admin a tu rama local.

**Cu√°ndo usarlo:** Antes de empezar a trabajar, o cuando sabes que hubo cambios en el Admin.

```bash
sf sync                      # Sincroniza normalmente
sf sync --dry-run           # Simula para ver qu√© cambiar√≠a
sf sync --force             # Confirma autom√°ticamente commits
```

### 3. `sf start` - Iniciar Desarrollo

**¬øQu√© hace?** Crea una nueva rama de trabajo basada en el tipo de cambio y sincroniza con Shopify.

**Cu√°ndo usarlo:** Al comenzar una nueva tarea de desarrollo.

```bash
sf start
# Muestra men√∫ interactivo:
# Selecciona el tipo de flujo (usa ‚Üë‚Üì flechas, Enter para seleccionar):
#   fix:Correcci√≥n de errores          ‚Üê (cursor aqu√≠)
#   feat:Nueva funcionalidad
#   hotfix:Correcci√≥n urgente en producci√≥n
#   refactor:Refactorizaci√≥n de c√≥digo
#   docs:Cambios en documentaci√≥n
#   style:Cambios de estilo/formato
#   test:Cambios en tests
#   chore:Tareas de mantenimiento
#
# Presiona Enter para seleccionar
# Ingresa nombre descriptivo en kebab-case
# Resultado: rama tipo/nombre-AAAAMMDD
```

### 4. `sf commit` - Confirmar Cambios

**¬øQu√© hace?** Guarda tus cambios locales en la rama actual con un mensaje descriptivo siguiendo el formato Conventional Commits.

**Cu√°ndo usarlo:** Despu√©s de hacer cambios en el c√≥digo y antes de publicar.

```bash
sf commit
# ‚úÖ Valida formato Conventional Commits (tipo: descripci√≥n)
# ‚úÖ Sugiere tipo de commit basado en archivos modificados
# ‚úÖ Muestra ejemplos si el formato es incorrecto
# ‚úÖ Valida que hay cambios para commitear
# ‚úÖ Crea commit con mensaje proporcionado
```

**Formatos de commit recomendados:**

- `feat: agregar nueva funcionalidad de login`
- `fix: corregir error en validaci√≥n de email`
- `docs: actualizar documentaci√≥n de instalaci√≥n`
- `style: formatear c√≥digo con prettier`
- `refactor: renombrar variables para mayor claridad`
- `test: agregar pruebas para componente header`
- `chore: actualizar dependencias`

**Caracter√≠sticas inteligentes:**

- **Validaci√≥n autom√°tica:** Verifica que el mensaje siga el formato `tipo: descripci√≥n`
- **Sugerencias inteligentes:** Propone el tipo de commit basado en los archivos modificados
- **Ejemplos interactivos:** Muestra ejemplos de formatos v√°lidos cuando es necesario
- **Flexibilidad:** Permite continuar con mensajes no convencionales si se confirma

### 5. `sf merge` - Fusionar Cambios a Master

**¬øQu√© hace?** Fusiona la rama de trabajo actual a la rama master y sincroniza con Shopify Admin.

**Cu√°ndo usarlo:** Cuando tus cambios est√°n listos para ser integrados a la rama principal.

```bash
sf merge                      # Fusionar normalmente
sf merge --dry-run           # Simula fusi√≥n para ver qu√© cambiar√≠a
sf merge --force             # Omite algunas validaciones de seguridad
```

**¬øQu√© hace exactamente?**

- ‚úÖ Fusiona la rama actual a master
- ‚úÖ Sincroniza cambios desde Shopify Admin
- ‚úÖ Crea backup autom√°tico antes de la operaci√≥n
- ‚úÖ Detecta conflictos potenciales
- ‚úÖ Sugiere pr√≥ximos pasos despu√©s del merge

**Validaciones inteligentes:**

- **Prevenci√≥n de conflictos:** Verifica conflictos antes de fusionar
- **Backup autom√°tico:** Guarda estado actual en caso de problemas
- **Sincronizaci√≥n:** Trae cambios de Shopify Admin despu√©s del merge
- **Sugerencias:** Recomienda probar cambios o publicar directamente

### 6. `sf publish` - Publicar Cambios

**¬øQu√© hace?** Publica los cambios desde la rama master a Shopify Admin (debes estar en master).

**Cu√°ndo usarlo:** Despu√©s de fusionar cambios a master y verificar que todo funciona.

```bash
sf publish                    # Publica normalmente
sf publish --dry-run         # Simula publicaci√≥n (recomendado primero)
sf publish --force           # Omite validaciones de seguridad
```

**¬øQu√© hace exactamente?**

- ‚úÖ Sincroniza con Shopify Admin antes de publicar
- ‚úÖ Publica tema en Shopify usando shopify theme push
- ‚úÖ Sube cambios a repositorio remoto (git push)
- ‚úÖ Valida que est√©s en la rama master

**Importante:** Debes estar en la rama master para publicar. Usa `sf merge` primero si est√°s en una rama de trabajo.

### 7. `sf resolve` - Resolver Conflictos

**¬øQu√© hace?** Confirma cambios resueltos despu√©s de un conflicto (solo confirma en Git, no publica a Shopify).

**Cu√°ndo usarlo:** Despu√©s de resolver conflictos manualmente en los archivos.

```bash
sf resolve
# ‚úÖ Agrega todos los archivos resueltos
# ‚úÖ Confirma con mensaje "resolve: conflictos de merge"
# ‚úÖ Sube cambios a repositorio remoto
# ‚úÖ NO publica autom√°ticamente a Shopify
```

**Flujo t√≠pico de resoluci√≥n:**

1. Un comando como `sf sync` o `sf merge` detecta conflictos
2. Resuelve conflictos manualmente editando los archivos
3. Ejecuta `git add <archivos>` para marcar como resueltos
4. Usa `sf resolve` para confirmar autom√°ticamente
5. **Prueba los cambios:** `sf dev --test`
6. **Publica manualmente:** `sf publish` cuando est√©s seguro

### 8. `sf finish` - Finalizar Trabajo

**¬øQu√© hace?** Elimina la rama de trabajo despu√©s de confirmar que todo est√° bien.

**Cu√°ndo usarlo:** Despu√©s de publicar exitosamente y verificar que todo funciona.

```bash
sf finish
# Confirma eliminaci√≥n de la rama
# ‚úÖ Elimina rama local si fue fusionada
# ‚úÖ Vuelve a rama master
```

## üîÑ Flujos Alternativos

### Continuar Trabajo en Rama Existente

Si ya tienes una rama de trabajo y quieres continuar desarrollando:

```bash
# Verifica en qu√© rama est√°s
sf status

# Si no est√°s en tu rama, c√°mbiate a ella
git checkout feat/mi-rama-20230925

# Contin√∫a trabajando normalmente
sf commit  # Cuando tengas cambios
sf publish # Cuando est√© listo
```

### Resolver Conflictos de Merge

Si `sf merge` o `sf sync` falla por conflictos:

```bash
# 1. Revisa qu√© archivos tienen conflictos
git status

# 2. Edita los archivos y resuelve conflictos manualmente
# (busca las marcas <<<<<<<, =======, >>>>>>>)

# 3. Agrega los archivos resueltos
git add archivo-conflicto.js

# 4. Confirma autom√°ticamente (sin publicar a Shopify)
sf resolve

# 5. Prueba los cambios antes de publicar
sf dev --test

# 6. Publica a Shopify cuando est√©s seguro
sf publish
```

### Cambios Urgentes (Hotfix)

Para correcciones cr√≠ticas que necesitan ir directo a producci√≥n:

```bash
# Crea rama de hotfix
sf start
# Selecciona "hotfix" en el men√∫

# Haz tus cambios urgentes
sf commit

# Para hotfix, puedes omitir algunas validaciones si es necesario
sf merge --force     # Fusiona a master (omite algunas validaciones)
sf publish           # Publica inmediatamente
```

### Sincronizar Cambios del Admin

Cuando sabes que hubo cambios manuales en Shopify Admin:

```bash
# Antes de empezar nuevo trabajo
sf sync --dry-run  # Ve qu√© cambiar√≠a
sf sync            # Trae los cambios

# Si hay conflictos, resu√©lvelos y continua
sf start           # Crea nueva rama desde el estado actualizado
```

### Recuperarse de un Error

Si algo sali√≥ mal durante el proceso:

```bash
# Ver historial de acciones
sf log --today

# Crear backup de trabajo actual
sf backup create

# Revisar diferencias
sf diff --with-master

# Restaurar si es necesario
sf backup restore nombre-del-backup
```

## üõ†Ô∏è Comandos Auxiliares

### `sf status` - Estado Inteligente del Proyecto

**¬øCu√°ndo usarlo?** En cualquier momento para obtener un an√°lisis completo del estado del proyecto y recibir sugerencias inteligentes sobre pr√≥ximos pasos.

```bash
sf status
# ‚úÖ Rama actual del proyecto
# ‚úÖ Conteo de cambios preparados y sin preparar
# ‚úÖ Archivos no rastreados por Git
# ‚úÖ Commits pendientes por publicar
# ‚úÖ Estado general del repositorio (limpio o con cambios)
# ‚úÖ Informaci√≥n de conexi√≥n con Shopify Admin
```

**Informaci√≥n mostrada:**

- **üåø Rama actual:** En qu√© rama est√°s trabajando
- **üìù Cambios preparados:** Archivos agregados al staging area
- **‚úèÔ∏è Cambios sin preparar:** Modificaciones no confirmadas
- **üìÑ Archivos no rastreados:** Nuevos archivos no agregados a Git
- **‚¨ÜÔ∏è Commits por publicar:** Cantidad de commits locales no enviados al remoto
- **‚úÖ Estado general:** Indicador de si el repositorio est√° limpio

### `sf dev` - Servidor de Desarrollo Local

**¬øCu√°ndo usarlo?** Para desarrollar y probar cambios localmente antes de publicar.

```bash
sf dev
# ‚úÖ Inicia servidor de desarrollo con shopify theme dev
# ‚úÖ Usa configuraci√≥n por defecto (tema de desarrollo)
# ‚úÖ Recarga autom√°tica al guardar cambios
# ‚úÖ Acceso local en http://127.0.0.1:9292
# ‚úÖ Verificaci√≥n de procesos existentes
```

**Caracter√≠sticas:**

- **üîÑ Recarga autom√°tica:** Los cambios se reflejan inmediatamente
- **üåê Acceso local:** Servidor disponible en puerto configurable
- **üõ°Ô∏è Verificaci√≥n:** Detecta si ya hay un servidor corriendo
- **‚öôÔ∏è Configurable:** Puerto, host y opciones personalizables
- **üéØ Tema de Desarrollo:** Ambiente seguro para probar cambios antes de publicar

```bash
# Modo de pruebas (informativo)
sf dev --test

# Opciones personalizadas
sf dev --port 3000 --host 0.0.0.0
```

### `sf stash` - Guardar Cambios Temporales

**¬øCu√°ndo usarlo?** Cuando necesitas cambiar de rama pero tienes cambios sin commitear.

```bash
sf stash
# Ingresa mensaje descriptivo para recordar qu√© guardaste
# ‚úÖ Guarda cambios locales temporalmente
```

## üîß Comandos de Mantenimiento

### `sf log` - Historial de Acciones

**¬øCu√°ndo usarlo?** Para debugging, seguimiento de cambios, o recordar qu√© hiciste.

```bash
sf log --today              # Ver qu√© hiciste hoy
sf log --last 10           # √öltimas 10 acciones
sf log --this-week         # Toda la semana
```

### `sf diff` - Comparar Diferencias

**¬øCu√°ndo usarlo?** Antes de publicar para verificar cambios, o para comparar ramas.

```bash
sf diff --with-master      # Ver qu√© cambiar√° al publicar
sf diff --with-shopify     # Simular vs Shopify Admin
```

### `sf clean` - Limpiar Ramas

**¬øCu√°ndo usarlo?** Peri√≥dicamente para mantener el repositorio ordenado.

```bash
sf clean --merged          # Eliminar ramas ya en master
sf clean --older-than 30   # Ramas con m√°s de 30 d√≠as
```

### `sf backup` - Copias de Seguridad

**¬øCu√°ndo usarlo?** Antes de operaciones riesgosas o para guardar estados importantes.

```bash
sf backup create           # Backup r√°pido en stash
sf backup branch           # Backup en rama separada
```

### `sf pr` - Pull Requests e Issues

**¬øCu√°ndo usarlo?** Para crear PR despu√©s de publicar, o para documentar issues.

```bash
sf pr                      # Crear PR con template
sf pr --title "Mi cambio"  # PR personalizado
```

## üìã Requisitos

- **Bash** (shell compatible)
- **Git** (control de versiones)
- **Shopify CLI** (interacci√≥n con tienda)
- **GitHub CLI** (opcional, para sf pr)

## ‚öôÔ∏è Configuraci√≥n

### Variables de Entorno

Crea un archivo `.env` en la ra√≠z del proyecto:

```bash
SHOPIFY_STORE="tu-tienda.myshopify.com"
SHOPIFY_THEME_ID="123456789"
```

### Configuraci√≥n Autom√°tica de Git

El script sf configura autom√°ticamente el archivo `.gitignore` para excluir archivos que no deben versionarse:

```bash
# Archivos excluidos autom√°ticamente:
.sf_history        # Historial de comandos del script sf
.env              # Variables de entorno sensibles
.shopify/         # Archivos temporales de Shopify CLI
```

**Nota:** El archivo `.sf_history` contiene el historial de comandos ejecutados y se mantiene localmente pero se excluye del repositorio Git.

### Alias Global (Recomendado)

Para ejecutar `sf` desde cualquier directorio:

```bash
# Agrega a ~/.bashrc o ~/.zshrc
alias sf="/ruta/absoluta/al/proyecto/sf"
source ~/.bashrc
```

## üîÑ Flujo de Trabajo Completo

### Ciclo de Desarrollo T√≠pico

```bash
# üèóÔ∏è Configuraci√≥n inicial (una sola vez por proyecto)
sf init

# üîÑ Sincronizaci√≥n (recomendado antes de empezar)
sf sync --dry-run  # Verificar si hay cambios en Admin
sf sync            # Traer cambios si los hay

# üöÄ Desarrollo
sf start           # Crear rama de feature
# ... hacer cambios en el c√≥digo ...
sf commit          # Confirmar cambios locales

# üîÄ Fusi√≥n a master
sf merge --dry-run # Simular fusi√≥n (siempre recomendado)
sf merge           # Fusionar rama a master

# ‚úÖ Publicaci√≥n
sf publish --dry-run  # Simular publicaci√≥n (siempre recomendado)
sf publish         # Publicar a producci√≥n

# üßπ Limpieza
sf finish          # Eliminar rama de trabajo

# üîÑ Siguiente ciclo
# Repite desde sf sync/sf start para el siguiente feature
```

### Flujo con Mantenimiento

```bash
# Verificaci√≥n diaria
sf status          # Ver estado del proyecto
sf log --today     # Ver qu√© hiciste hoy

# Limpieza semanal
sf clean --merged  # Limpiar ramas viejas
sf backup list     # Revisar backups antiguos

# Resoluci√≥n de problemas
sf diff --with-master  # Ver diferencias antes de publicar
sf backup create    # Crear backup antes de operaciones riesgosas
```

### Flujo para Equipos

```bash
# Al unirte a un proyecto existente
sf init            # Configurar entorno
sf sync            # Traer estado actual
sf status          # Verificar rama actual

# Durante desarrollo colaborativo
sf log --this-week # Ver actividad del equipo
sf diff --branches master feat/otra-rama  # Comparar con compa√±eros
```

## üÜò Soluci√≥n de Problemas

### Error: "Debes configurar las variables de entorno"

- Verifica que el archivo `.env` existe y tiene los valores correctos
- Aseg√∫rate de que las variables no est√©n vac√≠as
- El script valida autom√°ticamente el formato de las URLs de Shopify

### Error: "Dependencias faltantes"

```bash
# Instalar Git
sudo apt-get install git  # Ubuntu/Debian
brew install git           # macOS

# Instalar Shopify CLI
npm install -g @shopify/cli
# o
brew install shopify-cli   # macOS
```

### Error: "Conflicto en merge"

- Resuelve conflictos manualmente en los archivos
- Ejecuta `git add .` y `git commit -m "Resolve conflicts"`
- Luego contin√∫a con `sf publish`

### Mensajes de Validaci√≥n Mejorados

El script ahora proporciona mensajes espec√≠ficos con soluciones:

- **"Archivo .env no encontrado"** ‚Üí Crea el archivo con `sf init`
- **"Rama master no est√° limpia"** ‚Üí Confirma o guarda cambios antes de continuar
- **"Shopify CLI no disponible"** ‚Üí Instala dependencias faltantes
- **"Cambios sin commitear detectados"** ‚Üí Usa `sf commit` o `sf stash` seg√∫n corresponda

## üìù Notas para el Equipo

- Cada desarrollador debe configurar su propio alias apuntando a la ruta local del proyecto
- El archivo `.env` puede compartirse o ignorarse seg√∫n pol√≠ticas de seguridad
- Usa `sf log` para debugging y seguimiento de cambios
- Los comandos con `--dry-run` son seguros para probar operaciones

## üí° Consejos para Mejor UX

### üöÄ Acelera tu flujo de desarrollo

- **Usa `sf status`** para obtener an√°lisis inteligente del proyecto y sugerencias contextuales
- **Usa `sf sync --dry-run`** antes de `sf sync` para ver qu√© cambiar√°
- **Siempre usa `sf publish --dry-run`** antes de publicar para evitar sorpresas
- **Configura el alias global** para ejecutar `sf` desde cualquier directorio

### üîç Debugging y seguimiento

- **Revisa `sf log --today`** al empezar el d√≠a para recordar d√≥nde dejaste el trabajo
- **Usa `sf status`** frecuentemente para mantenerte orientado y recibir validaciones preventivas
- **Crea backups** con `sf backup create` antes de operaciones riesgosas

### üõ°Ô∏è Validaciones y Seguridad

- **Validaciones autom√°ticas:** El script detecta problemas comunes antes de que ocurran
- **Mensajes contextuales:** Errores espec√≠ficos con soluciones sugeridas
- **Prevenci√≥n de conflictos:** Alertas tempranas sobre posibles problemas de sincronizaci√≥n
- **Verificaci√≥n de dependencias:** Confirma que todas las herramientas necesarias est√°n disponibles

### üõ°Ô∏è Trabajo seguro

- **Sincroniza siempre** con `sf sync` antes de empezar nuevo trabajo
- **Verifica diferencias** con `sf diff --with-master` antes de publicar
- **Trabaja en ramas separadas** - nunca hagas cambios directamente en master

### üë• Trabajo en equipo

- **Comunica tus cambios** usando `sf pr` para crear Pull Requests
- **Revisa el historial** con `sf log --this-week` para entender el progreso del equipo
- **Limpia regularmente** con `sf clean --merged` para mantener el repositorio ordenado

### ‚ö° Atajos √∫tiles

```bash
# Ver estado inteligente y sugerencias
sf status          # An√°lisis completo + sugerencias de pr√≥ximos pasos

# Ver todo de una vez (estado + historial reciente)
sf status && sf log --last 5

# Flujo express (para cambios simples)
sf start && sf commit && sf publish --dry-run && sf publish && sf finish

# Verificar antes de publicar (con validaciones inteligentes)
sf diff --with-master && sf publish --dry-run
```

## ü§ù Contribuci√≥n

Si encuentras errores o mejoras, edita el script `sf` directamente o crea un issue/PR.
